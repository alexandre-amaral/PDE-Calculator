# Append the src directory to the Python path in order to checkout the code to be tested
# We could also use pip install -e, but this seems to be more reliable.
import sys
import os
sys.path.append(os.path.join(os.path.dirname(
    os.path.realpath(__file__)), "../src"))

import unittest
import logging

from Extractor import Extractor


class TestExtractor(unittest.TestCase):

    def compare_output(self, expected: dict, actual: dict, silent: bool = False) -> bool:
        """Compares the expected and actual output of the extractor. All keys in `expected` will be compared to the keys in `actual`.
        However, `actual` may contain additional keys, and this will still be considered a match.

        Args:
            expected (dict): the expected output
            actual (dict): the output from Extractor.
        """
        # logging.debug(f"Comparing \n {expected = } \nVERSUS\n{actual = }")
        for k, v in expected.items():
            if type(v) == dict:
                recurse = self.compare_output(v, actual[k], silent=silent)
                if not recurse:
                    if not silent: logging.error(f"{k=} & {v=} != {actual[k]}")
                    return False

            elif k not in actual or v != actual[k]:
                if not silent: logging.error(f"{k=} & {v=} != {actual[k]}")
                return False
        return True

    def test_compare_output(self):
        # Even tests has to be tested rsrs
        expected1 = {
            "name": "Water",
            "formula": "H2O",
            "info": {
                "something": "else",
                "more": "stuff"
            }
        }
        actual1 = {
            "name": "Water",
            "formula": "H2O",
            "info": {
                "something": "else",
                "more": "stuff",
                "more2": "stuff2"
            }
        }
        actual2 = {
            "name": "Ethanol",
            "formula": "CH3CH2OH",
            "info": {
                "something": "else",
                "more": "stuff",
                "more2": "stuff2"
            }
        }
        actual3 = {
            "name": "Water",
            "formula": "H2O",
            "info": {
                "something": "error",
                "more": "stuff",
                "more2": "stuff2"
            }
        }


        self.assertTrue(self.compare_output(expected1, actual1))
        self.assertFalse(self.compare_output(expected1, actual2, silent=True))
        self.assertFalse(self.compare_output(expected1, actual3, silent=True))

    def run_substance_test(self, expected: dict) -> None:
        ext = Extractor(expected["name"])
        self.assertTrue(self.compare_output(expected, ext.data))

    def test_thalidomide(self):
        expected = {
            "name": "thalidomide",
            "cid": 5426,
            "toxicity": {
                "summary": r"The R-configuration and the S-configuration are more toxic individually than the racemic mixture. The LD50 could not be established in mice for racemic thalidomide, whereas LD50 values for the R and S configurations are reported to be 0.4 to 0.7 g/kg and 0.5 to 1.5 g/kg, respectively.",
                "moreInformation": r"IDENTIFICATION AND USE: Thalidomide is a white to off-white crystalline powder. Thalidomide is an immunomodulatory agent with anti-inflammatory, antiangiogenic, and sedative and hypnotic activity. It is used for the acute treatment of the cutaneous manifestations of moderate to severe erythema nodosum leprosum (ENL). It is also used as maintenance therapy for prevention and suppression of the cutaneous manifestations of erythema nodosum leprosum recurrence. It is used in combination with dexamethasone for the treatment of patients with newly diagnosed multiple myeloma. HUMAN EXPOSURE AND TOXICITY: Overdosage of thalidomide may cause prolonged sleep as a result of the drug's sedative and hypnotic effects, but fatalities are unlikely since the drug does not cause respiratory depression. In 3 reported suicide attempts involving deliberate ingestion of up to 14.4 g of thalidomide, all individuals recovered without reported sequelae. Thalidomide is a known human teratogen. The severe malformation induced by thalidomide may involve defects of the limbs, axial skeleton, head and face, eyes, ears, tongue, teeth, central nervous, respiratory, cardiovascular, and genitourinary systems, and the gastrointestinal tract. The neurological complications may include severe mental retardation secondary to sensory deprivation. Thus, thalidomide is contraindicated during pregnancy. Thalidomide is also known to cause nerve damage that may be permanent. Peripheral neuropathy is a common (> or =10%) and potentially severe adverse reaction of treatment with thalidomide that may be irreversible. Seizures have been reported, including  tonic-clonic (grand mal) seizures. Serious dermatologic reactions including Stevens-Johnson syndrome and toxic epidermal necrolysis, which may be fatal, have also been reported. The use of thalidomide in multiple myeloma patients causes an increased risk of venous thromboembolism, such as deep venous thrombosis and pulmonary embolism. ANIMAL STUDIES: In an acute toxicity study, guinea pigs administered a 650 mg/kg oral dose became quiet and sedated. Two-year carcinogenicity studies were conducted in male and female mice, male and female rats. No compound-related tumorigenic effects were observed at the highest dose levels in male and female mice (9 to 14-fold human exposure), and male rats (12-fold human exposure). In female rats, a tumorigenic effect was not observed at 300 mg/kg/day (16-fold human exposure). In another carcinogenicity study, 56 adult beagle dogs were orally administered thalidomide for 53 weeks. There were no deaths during the study. There was no gross and histopathologic evidence of any tumors. A large number of reproductive studies have shown that thalidomide is a potent teratogen. Cynomolgus monkeys were orally administered thalidomide at 15 or 20 mg/kg-d on days 26-28 of gestation, and fetuses were examined on day 100-102 of gestation. Limb defects such as micromelia/amelia, paw/foot hyperflexion, polydactyly, syndactyly, and brachydactyly were observed in seven of eight fetuses. The teratogenicity of thalidomide in rats was investigated after a single maternal intravenous injection during the organogenesis period. Thalidomide induced skeletal deformities of thoracic ribs and of the spinal column in fetuses upon maternal administration of the drug. Deformities of the eyeball in fetuses were induced by the maternal administration of the drug on day 10 and 12. A single dose (500 mg/kg) of thalidomide was administered orally to pregnant rabbits in various stages of organogenesis. Head anomalies in fetuses were induced at a high frequency by the maternal administration of thalidomide on day 7. Microphthalmia in fetuses was observed with a single administration from day 7 to 12 of gestation. Contracture of forearms and club foot in fetuses resulted from the maternal administration of thalidomide on day 8 or 9 of gestation, respectively. With a single administration on day 8 or 9 of gestation, kinky tail in fetuses resulted, and brachyury was observed with a high frequency from day 8 to 11 of gestation. Skeletal anomalies such as fusion or displacement of coccygeal vertebral bodies were observed at a high frequency with a single treatment from day 8 to 10 of gestation. Among the internal anomalies observed was abnormal lobation of the lung, and abnormal lobation of the liver, cardiovascular anomalies. Fertility studies were conducted in male and female rabbits; no compound-related effects in mating and fertility indices were observed at any oral thalidomide dose level including the highest of 100 mg/kg/day to female rabbits and 500 mg/kg/day to male rabbits. Thalidomide was neither mutagenic nor genotoxic in the following assays: the Ames bacterial (Salmonella typhimurium and Escherichia coli) reverse mutation assay, a Chinese hamster ovary cell forward mutation assay, and an in vivo mouse micronucleus test."
            }
        }
        self.run_substance_test(expected)

    def test_ethanol(self):
        expected = {
            "name": "ethanol",
            "cid": 702,
            "toxicity": {
                "summary": r"Oral, rat LD50: 5628 mg/kg. Symptoms and effects of overdose include nausea, vomiting, CNS depression, acute respiratory failure or death and with chronic use, severe health problems, such as liver and brain damage.",
                "moreInformation": r"IDENTIFICATION AND USE: Ethanol is a clear, colorless, very mobile liquid. It is used in alcoholic beverages in suitable dilutions, and as a reagent in synthetic organic chemistry  and chromatography, as well as industrial and laboratory organic solvent. Other uses are in manufacture of denatured alcohol, pharmaceuticals (rubbing compounds, lotions, tonics, colognes), in perfumery. Octane booster in gasoline. Pharmaceutic aid (solvent). HUMAN STUDIES: Ethanol is a central nervous system (CNS) depressant. It enhances the inhibitory effects of gamma-aminobutyric acid (GABA) at the GABA-A receptor and competitively inhibits the binding of glycine at the N-methyl-d-aspartate receptor (it disrupts excitatory glutaminergic neurotransmission). Ethanol also stimulates release of other inhibitory neurotransmitters, such as dopamine and serotonin. The most common clinical signs of ethanol toxicosis are ataxia, lethargy, vomiting, and recumbency. In more severe cases, hypothermia, disorientation, vocalization, hypotension, tremors, tachycardia, acidosis, diarrhea, respiratory depression, coma, seizures, and death may occur. Alcohol is directly irritating to the stomach and causes vomiting. High ethanol blood levels also stimulate emesis. The concern with vomiting during intoxication is that at high blood ethanol concentrations, the muscles that control the epiglottis become slow to react or even paralyzed. This increases the risk for aspiration. Ethanol intoxication reduces peripheral oxygen delivery and metabolism and causes mitochondrial oxidative dysfunction, potentially resulting in shock or hypoxia in an acutely intoxicated patient. Hypothermia may result from multiple mechanisms. Peripheral vasodilation, CNS depression, ethanol interference with the thermoregulator mechanism, and/or impaired behavioral responses to a cold environment all lead to a lowered body temperature. Moderate ethanol intake appears to reduce the risk of myocardial infarction and other heart diseases. However, high spirits consumption was associated with increased risk of cancer mortality in women. Consumption of alcoholic beverages (beer, in particular) is associated with an increased risk for rectal but not colon cancer. Beer is a commonly consumed alcoholic beverage among reproductive-age adults. Beer drinking males have an increased risk of contributing to pregnancy waste. Women consume beer before and after pregnancy recognition. Binge drinking appears to be a common drinking behavior, and those who binge drink have an increased risk of impaired fetal growth and offspring behavior. Beer consumption by lactating women might temporarily impair motor function of nursing infants. The rate of ethanol metabolism varies among individuals. Studies of twins indicate that interindividual variability in the rate of ethanol metabolism may be genetically controlled. The main pathway for ethanol oxidation in humans is to acetaldehyde via alcohol dehydrogenase pathway. Acetaldehyde is oxidized further to acetic acid by aldehyde dehydrogenase. Asians are known to be sensitive to the health effects of ethanol; the sensitivity has been attributed to different forms of the enzyme acetaldehyde dehydrogenase. Alcohol ingestion by Asians resulted in marked elevations of blood acetaldehyde levels ranging from 0.4 to 3 mg/L, and individuals developed facial flushing and tachycardia as a direct consequence of elevated blood acetaldehyde levels. ANIMAL STUDIES: A drop full-strength ethanol on rabbit eyes causes reversible injury graded only 3 on a scale of 10 after 24 hr. Application of 70% alcohol to rabbit corneas injures and temporarily loosens the corneal epithelium, but the recovery is complete. When rats were dosed with ethanol by oral gavage with 8 to 15 g/kg/day over 4 months and fed a diet containing 25% of total calories as fat, focal necrosis, inflammation, and fibrosis were observed in the liver. Nine baboons fed ethanol at 50% of total calories developed fatty liver, and four animals developed hepatitis within 9 to 12 months. Rabbits exposed to saturated vapors of ethanol for periods ranging from 25 to 365 days developed cirrhosis of the liver. Rats were given a single intraperitoneal dose of diethylnitrosamine followed by treatment with ethanol in drinking water for 12 to 18 months. Ethanol was an effective promoter of liver tumors. Cynomolgus monkeys administered up to 5 g/kg bw ethanol daily on gestation days 20-150 revealed an increase in pregnancy wastage (abortions and still births) but no structural malformation or facial change. Ethanol, and not acetaldehyde, has been implicated as the causative agent of the teratogenic effects in laboratory animals. Oral coadministration of 100 mg/kg of 4-methylpyrazole, an inhibitor of alcohol dehydrogenase, with 6 g/kg of ethanol intraperitoneally on gestation day 10 dramatically increased the embryotoxicity of ethanol in mice. Ethanol is not mutagenic in Salmonella typhimurium strains TA 97, TA 98, TA 100, TA 1535, TA 1537, or TA 1538 in the presence or absence of metabolic activation. In the presence of a metabolic activation system, ethanol is slightly mutagenic to Salmonella strain TA 102, a strain considered to respond to the presence of oxygen radicals. Ethanol did not induce mutations in mouse lymphoma L5178Y TK+/- cells and did not induce micronuclei in Chinese hamster V79 cells in the absence of metabolic activation. No chromosomal aberrations or sister chromatid exchanges were observed in Chinese hamster ovary cells treated with ethanol. ECOTOXICITY STUDIES: The zebrafish were exposed to different concentrations (control, 0.01, 0.1, and 1%) of ethanol from blastula stage to 144 hour-post-fertilization (hpf). No effect on survival was observed except the 1% ethanol group suffered 89% mortality during 108-120 hpf. No developmental defects were observed at the 0.01 and 0.1% concentrations, but significantly higher deformity rates occurred with 1% ethanol. Hyperactivity and less tortuous swimming paths were observed in all ethanol concentrations."
            }
        }
        self.run_substance_test(expected)

    def test_paracetamol(self):
        expected = {
            "name": "paracetamol",
            "cid": 1983,
            "toxicity": {
                "summary": r"LD50 = 338 mg/kg (oral, mouse); LD50 = 1944 mg/kg (oral, rat)  **Overdose and liver toxicity**   Acetaminophen overdose may be manifested by renal tubular necrosis, hypoglycemic coma, and thrombocytopenia. Sometimes, liver necrosis can occur as well as liver failure. Death and the requirement of a liver transplant may also occur. Metabolism by the CYP2E1 pathway releases a toxic acetaminophen metabolite known as _N-acetyl-p-benzoquinoneimine_(NAPQI). The toxic effects caused by this drug are attributed to NAPQI, not acetaminophen alone.  **Carcinogenesis**  Long-term studies in mice and rats have been completed by the National Toxicology Program to study the carcinogenic risk of acetaminophen. In 2-year feeding studies, F344/N rats and B6C3F1 mice consumed a diet containing acetaminophen up to 6,000 ppm. Female rats showed evidence of carcinogenic activity demonstrated by a higher incidence of mononuclear cell leukemia at doses 0.8 times the maximum human daily dose (MHDD). No evidence of carcinogenesis in male rats (0.7 times) or mice (1.2 to 1.4 times the MHDD) was noted. The clinical relevance of this finding in humans is unknown.  **Mutagenesis**  Acetaminophen was not found to be mutagenic in the bacterial reverse mutation assay (Ames test). Despite this finding, acetaminophen tested positive in the in vitro mouse lymphoma assay as well as the in vitro chromosomal aberration assay using human lymphocytes. In published studies, acetaminophen has been reported to be clastogenic (disrupting chromosomes) when given a high dose of 1,500 mg/kg/day to the rat model (3.6 times the MHDD). No clastogenicity was observed at a dose of 750 mg/kg/day (1.8 times the MHDD), indicating that this drug has a threshold before it may cause mutagenesis. The clinical relevance of this finding in humans is unknown.  **Impairment of Fertility**  In studies conducted by the National Toxicology Program, fertility assessments have been performed in Swiss mice in a continuous breeding study. No effects on fertility were seen.   **Use in pregnancy and nursing**  The FDA label for acetaminophen considers it a pregnancy category C drug, meaning this drug has demonstrated adverse effects in animal studies. No human clinical studies in pregnancy have been done to this date for intravenous acetaminophen. Use acetaminophen only when necessary during pregnancy. Epidemiological data on oral acetaminophen use in pregnant women demonstrate no increase in the risk of major congenital malformations. While prospective clinical studies examining the results of nursing with acetaminophen use have not been conducted, acetaminophen is found secreted in human milk at low concentrations after oral administration. Data from more than 15 nursing mothers taking acetaminophen was obtained, and the calculated daily dose of acetaminophen that reaches the infant is about 1 to 2% of the maternal dose. Caution should be observed when acetaminophen is taken by a nursing woman.",
                "moreInformation": r"IDENTIFICATION AND USE: Acetaminophen is an odorless compound with a slightly bitter taste. It is a common analgesic and antipyretic agent used for the relief of fever as well as aches and pains associated with many conditions. HUMAN EXPOSURE AND TOXICITY: Nausea, vomiting, and abdominal pain usually occur within 2-3 hours after ingestion of toxic doses of the drug. In severe poisoning, CNS stimulation, excitement, and delirium may occur initially. This may be followed by CNS depression, stupor, hypothermia, marked prostration, rapid shallow breathing, rapid weak irregular pulse, low blood pressure, and circulatory failure. When an individual has ingested a toxic dose of acetaminophen, the individual should be hospitalized for several days of observation, even if there are no apparent ill effects, because maximum liver damage and/or cardiotoxic effects usually do not become apparent until 2-4 days after ingestion of the drug. Other symptoms of acute poisoning include cerebral edema and nonspecific myocardial depression. Vascular collapse results from the relative hypoxia and from a central depressant action that occurs only with massive doses. Shock may develop if vasodilation is marked. Fatal seizures may occur. Coma usually precedes death, which may occur suddenly or may be delayed for several days. Biopsy of the liver reveals centralobular necrosis with sparing of the periportal area. There have been reports of acute myocardial necrosis and pericarditis in individuals with acetaminophen poisoning. Hypoglycemia, which can progress to coma have been reported in patients ingesting toxic doses of acetaminophen. Low prothrombin levels and thrombocytopenia have been reported in patients with acetaminophen poisoning. Skin reactions of an erythematous or urticarial nature which may be accompanied by fever and oral mucosal lesions also have been reported. For use anytime during pregnancy, 781 exposures were recorded, and possible associations with congenital dislocation of the hip (eight cases) and clubfoot (six cases) were found. There is inadequate evidence in humans for the carcinogenicity of acetaminophen. ANIMAL TOXICITY STUDIES: There is inadequate evidence in experimental animals for the carcinogenicity of acetaminophen. In rats fasted 24 hours and given a single dose of acetaminophen (2 g/kg) by gavage, liver necrosis around the central vein was noted at 9-12 hours and was much more extensive at 24 hours after treatment. In mice after dietary exposure to acetaminophen up to 6400 mg/kg daily for 13 weeks hepatotoxicity, organ weight changes and deaths were observed. Cats are particularly susceptible to acetaminophen intoxication, developing more diffuse liver changes, while hepatic centrilobular lesions found in dogs. High doses of acetaminophen caused testicular atrophy and delay in spermiogenesis in mice. Furthermore, reductions in the fertility and neonatal survival in mice were seen in the F0 generation and decreases in F1 pup weights were found at acetaminophen dose 1430 mg/kg. Acetaminophen was not mutagenic in Salmonella typhimurium assay with or without metabolic activation in six strains: TA1535, TA1537, TA1538, TA100, TA97 and TA98. In vitro and animal data indicate that small quantities of acetaminophen are metabolized by a cytochrome P-450 microsomal enzyme to a reactive intermediate metabolite (N-acetyl-p-benzoquinoneimine, N-acetylimidoquinone, NAPQI) which is further metabolized via conjugation with glutathione and ultimately excreted in urine as a mercapturic acid. It has been suggested that this intermediate metabolite is responsible for acetaminophen-induced liver necrosis in cases of overdose. Excipients found in liquid formulations of acetaminophen may decrease its liver toxicity. ECOTOXICITY STUDIES: Daphnia magna was the most susceptible among the test organisms to the environmental effects of acetaminophen. Acetaminophen has recently been identified as a promising snake toxicant to reduce brown tree snake populations on Guam, while posing only the minimal risks to non-target rodents, cats, pigs and birds."
            }
        }
        self.run_substance_test(expected)

    def test_tacrolimus(self):
        expected = {
            "name": "tacrolimus",
            "cid": 445643,
            "toxicity": {
                "summary": r"Side effects can be severe and include blurred vision, liver and kidney problems (it is nephrotoxic), seizures, tremors, hypertension, hypomagnesemia, diabetes mellitus, hyperkalemia, itching, insomnia, confusion. LD50=134-194 mg/kg (rat).",
                "moreInformation": r"IDENTIFICATION AND USE: Tacrolimus is white to off-white crystalline powder. It is a calcineurin-inhibitor immunosuppressant available in several preparations. Tacrolimus in both oral capsules and a solution for IV injection is used for prophylaxis of organ rejection in patients receiving liver, kidney or heart transplants. Tacrolimus topical ointment is used as a second-line therapy for the short-term and non-continuous chronic treatment of moderate to severe atopic dermatitis in non-immunocompromised adults and children. HUMAN EXPOSURE AND TOXICITY: While most acute overdosages of tacrolimus at up to 30 times the intended dose have been asymptomatic and all patients recovered with no sequelae, some acute overdosages were followed by adverse reactions including  tremors, abnormal renal function, hypertension, and peripheral edema. At therapeutic doses, patients receiving tacrolimus are at increased risk of developing lymphomas and other malignancies, particularly of the skin, as well as an increased risk of developing bacterial, viral, fungal, and protozoal infections, including opportunistic infections. These infections may lead to serious, including  fatal, outcomes. While there are no adequate and well-controlled studies in pregnant women, the use of tacrolimus during pregnancy in humans has been associated with neonatal hyperkalemia and renal dysfunction. ANIMAL STUDIES: Both rats and baboons showed a similar toxicologic profile following oral or intravenous administration of tacrolimus. Toxicity following intravenous administration was evident at lower doses than after oral administration for both rats and baboons. Toxicity was seen at lower doses in rats than in baboons. The primary target organs were the kidneys, pancreatic islets of Langerhans and exocrine pancreas, spleen, thymus, gastrointestinal tract, and lymph nodes. In addition, decreases in erythrocyte parameters were seen. Tacrolimus also produced reproductive and developmental toxicity in both rats and rabbits. In rats, chronic oral administration of tacrolimus at high doses resulted in changes in sex organs, and glaucoma/eye changes. Oral doses of tacrolimus at 1 and 3.2 mg/kg/day produced overt signs of parental toxicity and changes in the fertility and general reproductive performance of rats. Effects on reproduction included some embryo lethality, reduced number of implantations, increased incidence of post-implantation loss, and reduced embryo and offspring viability. In a rabbit teratology study, signs of maternal toxicity including reduced body weight were produced at all oral doses of tacrolimus administered (0.1, 0.32, or 1 mg/kg/day). Doses of 0.32 and 1 mg/kg/day produced signs of developmental toxicity, such as increased incidence of post-implantation losses, reduced number of viable fetuses, and increased incidences of morphological variations. In a rat teratology study, increased post-implantation loss was observed at 3.2 mg/kg/day. Maternal doses of 1 mg/kg/day decreased the body weight of F1 offspring. Decreased body weight, reduced survival number, and some skeletal alterations were seen in F1 offspring at maternal doses of 3.2 mg/kg/day. Tacrolimus did not exhibit genotoxic activity in vitro in bacterial asaays in Salmonella typhimurium and Escherichia coli or mammalian assays in Chinese hamster lung-derived cells assays. No evidence of mutagenicity was observed in vitro in the CHO/HGPRT assay (the Chinese hamster ovary cell assay (CHO), which measures forward mutation of the HGPRT locus) or in vivo in clastogenicity assays performed in mice. Tacrolimus also did not cause unscheduled DNA synthesis in rodent hepatocytes."
            }
        }
        self.run_substance_test(expected)

    def test_lamotrigine(self):
        expected = {
            "name": "lamotrigine",
            "cid": 3878,
            "toxicity": {
                "summary": r"The oral LD50 in mouse and rat is 205 mg/kg and 245 mg/kg, respectively.[MSDS]  Fatal cases of overdose of up to 15g of lamotrigine have been reported. Overdose with lamotrigine has been manifested by ataxia, nystagmus, increased seizures, decreased level of consciousness, coma, and intraventricular conduction delay. Though no known antidote exists for lamotrigine, hospitalization and general supportive measures should be employed in the case of a suspected lamotrigine overdose. Gastric lavage and emesis may be warranted with simultaneous protection of the airway. It is uncertain at this time whether hemodialysis is an effective means of removing lamotrigine from the sytemic circulation.",
                "moreInformation": r"IDENTIFICATION AND USE: Lamotrigine is a white to pale cream-colored powder. Lamotrigine is an anticonvulsant medication that also has utility in the treatment of bipolar disorder. HUMAN EXPOSURE AND TOXICITY: Lamotrigine has been associated with many side effects, including rashes that can progress to Stevens-Johnson syndrome or toxic epidermal necrolysis. It has also been associated with the development of motor tics, most commonly in the head, neck, and shoulders. Cases of life-threatening rashes associated with lamotrigine almost always have occurred within 2-8 weeks of treatment initiation; however, severe rashes rarely have presented following prolonged treatment (e.g., 6 months). Lamotrigine-associated rashes do not appear to have distinguishing features. Because it is not possible to distinguish benign rashes from those that may become severe and/or life-threatening, lamotrigine generally should be discontinued at the first sign of rash (unless the rash is known not to be drug related). However, a rash may become life-threatening or permanently disabling or disfiguring despite discontinuance of the drug. Discontinuance of lamotrigine because of rash was required in 3% of adults receiving the drug as adjunctive therapy and 4.5% of adults receiving the drug as monotherapy in controlled clinical trials; 4.4% of pediatric patients receiving lamotrigine in controlled clinical trials discontinued the drug because of the development of rash. Multiorgan failure and various degrees of hepatic failure, in some cases fatal, have been reported rarely with lamotrigine as adjunctive therapy. The possibility of such potentially fatal adverse effects should be considered in patients who exhibit signs and symptoms associated with multiorgan and/or hepatic impairment following initiation of lamotrigine as adjunctive therapy. During the premarketing development of lamotrigine, 20 sudden and unexplained deaths were reported among a cohort of 4700 patients with epilepsy receiving adjunctive therapy with the drug (5747 patient-years of exposure). Although the rate of these deaths exceeds that expected to occur in a healthy (nonepileptic) population matched for age and gender, this rate was similar to that occurring in a similar population of epileptic patients receiving a chemically unrelated anticonvulsant agent. Among 414 first-trimester exposures to lamotrigine monotherapy, 12 outcomes with major birth defects were reported. Among the 88 first-trimester exposures to lamotrigine polytherapy including valproate, 11 outcomes with major birth defects were reported. Among 182 first-trimester exposures to lamotrigine polytherapy excluding valproate, 5 outcomes with major birth defects were reported. No distinctive pattern of major birth defects was apparent among the offspring exposed to lamotrigine monotherapy or polytherapy. The risk of all major birth defects after first-trimester exposure to lamotrigine monotherapy (2.9%) was similar to that in the general population and in other registries enrolling women exposed to antiepileptic monotherapy (3.3% to 4.5%). Lamotrigine also did not increase the incidence of structural or numerical chromosomal abnormalities in the in vitro human lymphocyte assay. ANIMAL STUDIES: In animal studies, no evidence of carcinogenicity was seen following oral administration of lamotrigine for up to 2 years at maximum tolerated doses (30 mg/kg of body weight per day in mice and 10 to 15 mg/kg per day in rats). Lamotrigine administered i.p. at high doses can induce intrauterine growth retardation and at low multiple doses causes a dose-dependent increase in embryonic resorption, craniofacial and caudal malformations as well as maternal toxicity in the mouse. A study of the teratogenic activity of lamotrigine was carried out in the brain of fetuses of rats who had received the drug. Results showed that fetuses of the experimental group had reduced body weight at birth, increased volume and diameter of the cerebral structure, increased density of the subcortical layer, and ventricle dilatation. A behavioral teratology study was conducted in rats dosed during the period of organogenesis. At day 21 postpartum, offspring of dams receiving 5 mg/kg per day or higher displayed a significantly longer latent period for open field exploration and a lower frequency of rearing. In a swimming maze test performed on days 39 to 44 postpartum, time to completion was increased in offspring of dams receiving 25 mg/kg per day. No evidence of mutagenicity was demonstrated by lamotrigine in vitro in the Ames Salmonella microbial mutagen test or the mammalian mouse lymphoma assay.  Lamotrigine also did not increase the incidence of structural or numerical chromosomal abnormalities in the in vivo rat bone marrow assay."
            }
        }
        self.run_substance_test(expected)

    def test_cyclosporine(self):
        expected = {
            "name": "cyclosporine",
            "cid": 5284373,
            "toxicity": {
                "summary": r"The oral LD50 in rats is 1480 mg/kg and the TDLO in humans is 12 mg/kg.   **Overdose information**  In cases of overdose with oral cyclosporine, forced emesis and gastric lavage are recommended 2 hours after ingestion. There are little data available in the literature regarding overdoses with cyclosporine, but hepatotoxicity and nephrotoxicity may occur. One case report of an cyclosporine overdose due to medical error was made involving a 26 year old female and noted the occurrence of nausea, flushing, tremor, vertigo and vomiting, which resolved within about 1 day. Anorexia and a feeling of increased body girth were also experienced by this patient and resolved within about 2 weeks. When overdose with cyclosporine is observed, it is important to consider that dialysis and charcoal, hemoperfusion are not effective techniques to remove cyclosporine from the body.",
                "moreInformation": r"" # TODO: when a key is missing, decide whether to include it empty or just skip it
            }
        }
        self.run_substance_test(expected)



if __name__ == '__main__':
    unittest.main()
